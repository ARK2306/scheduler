{"ast":null,"code":"import _objectSpread from\"/Users/aryanreddy/Desktop/hobbies/scheduler/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import AdminLogin from'./AdminLogin';import config from'../config';import'./AdminPage.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function AdminPage(){const[isAuthenticated,setIsAuthenticated]=useState(false);const[authToken,setAuthToken]=useState(null);const[currentView,setCurrentView]=useState('create');// 'create', 'responses', 'generate'\nconst[timeblocks,setTimeblocks]=useState([]);const[selectedDay,setSelectedDay]=useState('Monday');const[selectedTime,setSelectedTime]=useState('5:00 AM');const[shiftType,setShiftType]=useState('both');const[duration,setDuration]=useState(0.5);const[peopleNeeded,setPeopleNeeded]=useState(1);const[currentScheduleId,setCurrentScheduleId]=useState(null);const[employeeResponses,setEmployeeResponses]=useState([]);const[shiftsPerEmployee,setShiftsPerEmployee]=useState({});const[finalSchedule,setFinalSchedule]=useState(null);const daysOfWeek=['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];const timeSlots=['5:00 AM','5:30 AM','6:00 AM','6:30 AM','7:00 AM','7:30 AM','8:00 AM','8:30 AM','9:00 AM','9:30 AM','10:00 AM','10:30 AM','11:00 AM','11:30 AM','12:00 PM','12:30 PM','1:00 PM','1:30 PM','2:00 PM','2:30 PM','3:00 PM','3:30 PM','4:00 PM','4:30 PM','5:00 PM','5:30 PM','6:00 PM','6:30 PM','7:00 PM','7:30 PM','8:00 PM','8:30 PM','9:00 PM','9:30 PM','10:00 PM','10:30 PM','11:00 PM','11:30 PM'];const addTimeblock=()=>{const newTimeblock={id:Date.now(),day:selectedDay,time:selectedTime,duration:duration,shiftType:shiftType,peopleNeeded:peopleNeeded,title:\"\".concat(shiftType==='grad'?'Grad Only':shiftType==='undergrad'?'Undergrad Only':'Both',\" - \").concat(duration===0.5?'30min':duration%1===0?duration+'h':duration+'h',\" (\").concat(peopleNeeded,\" \").concat(peopleNeeded===1?'person':'people',\")\")};setTimeblocks([...timeblocks,newTimeblock]);};const removeTimeblock=id=>{setTimeblocks(timeblocks.filter(block=>block.id!==id));};const handleLogin=token=>{setAuthToken(token);setIsAuthenticated(true);};const handleLogout=()=>{localStorage.removeItem('adminToken');setAuthToken(null);setIsAuthenticated(false);setCurrentScheduleId(null);setTimeblocks([]);setEmployeeResponses([]);setFinalSchedule(null);};const deleteSchedule=async()=>{if(!currentScheduleId)return;const confirmDelete=window.confirm('Are you sure you want to delete the current schedule? This will remove all timeblocks and employee responses.');if(!confirmDelete)return;try{const response=await fetch(\"\".concat(config.API_BASE_URL,\"/api/admin/delete-schedule/\").concat(currentScheduleId),{method:'DELETE',headers:{'Authorization':\"Bearer \".concat(authToken)}});if(response.ok){// Clear all local state\nsetCurrentScheduleId(null);setTimeblocks([]);setEmployeeResponses([]);setFinalSchedule(null);setCurrentView('create');alert('Schedule deleted successfully!');}else{alert('Failed to delete schedule');}}catch(error){console.error('Failed to delete schedule:',error);alert('Failed to delete schedule');}};const saveScheduleTemplate=async()=>{try{const response=await fetch(\"\".concat(config.API_BASE_URL,\"/api/admin/create-schedule\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(authToken)},body:JSON.stringify({timeblocks})});if(response.ok){const result=await response.json();setCurrentScheduleId(result.scheduleId);setCurrentView('responses');}}catch(error){console.error('Failed to save schedule:',error);alert('Failed to save schedule template');}};const loadEmployeeResponses=async function(){let scheduleId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:currentScheduleId;if(!scheduleId||!authToken)return;try{const response=await fetch(\"\".concat(config.API_BASE_URL,\"/api/admin/employee-responses/\").concat(scheduleId),{headers:{'Authorization':\"Bearer \".concat(authToken)}});if(response.ok){const result=await response.json();setEmployeeResponses(result.responses);// Initialize shifts per employee\nconst initialShifts={};result.responses.forEach(resp=>{initialShifts[resp.employeeName]=3;// default\n});setShiftsPerEmployee(initialShifts);}}catch(error){console.error('Failed to load employee responses:',error);}};const generateFinalSchedule=async()=>{try{const response=await fetch(\"\".concat(config.API_BASE_URL,\"/api/admin/generate-final-schedule\"),{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(authToken)},body:JSON.stringify({scheduleId:currentScheduleId,shiftsPerEmployee})});if(response.ok){const result=await response.json();setFinalSchedule(result);setCurrentView('generate');}}catch(error){console.error('Failed to generate schedule:',error);alert('Failed to generate final schedule');}};useEffect(()=>{// Check for stored auth token\nconst storedToken=localStorage.getItem('adminToken');if(storedToken){setAuthToken(storedToken);setIsAuthenticated(true);}},[]);useEffect(()=>{// Load admin dashboard state when authenticated\nif(isAuthenticated&&authToken){loadAdminDashboard();}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[isAuthenticated,authToken]);useEffect(()=>{if(currentView==='responses'&&currentScheduleId){loadEmployeeResponses();}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[currentView,currentScheduleId]);const loadAdminDashboard=async()=>{if(!authToken)return;try{const response=await fetch(\"\".concat(config.API_BASE_URL,\"/api/admin/dashboard\"),{headers:{'Authorization':\"Bearer \".concat(authToken)}});if(response.ok){const dashboard=await response.json();if(dashboard.hasCurrentSchedule){setCurrentScheduleId(dashboard.currentScheduleId);setTimeblocks(dashboard.currentTemplate.timeblocks||[]);// If there are responses, load them\nif(dashboard.responseCount>0){await loadEmployeeResponses(dashboard.currentScheduleId);}}}}catch(error){console.error('Failed to load admin dashboard:',error);}};const renderCreateView=()=>/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"deployment-link\",children:/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\uD83C\\uDF10 Live Application: \",/*#__PURE__*/_jsx(\"a\",{href:\"https://scheduler-bak7smwus-aryan-reddy-kalluris-projects.vercel.app\",target:\"_blank\",rel:\"noopener noreferrer\",children:\"https://scheduler-bak7smwus-aryan-reddy-kalluris-projects.vercel.app\"})]})}),/*#__PURE__*/_jsx(\"h2\",{children:\"Admin Portal - Create Weekly Schedule\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Add timeblocks to create the weekly schedule template\"}),currentScheduleId&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"current-schedule-info\",children:[\"\\u2705 Current Schedule ID: \",currentScheduleId,/*#__PURE__*/_jsx(\"button\",{className:\"delete-schedule-btn\",onClick:deleteSchedule,children:\"\\uD83D\\uDDD1\\uFE0F Delete Schedule\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"employee-link-display\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDC65 Link for Employees:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"employee-link-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:\"\".concat(window.location.origin,\"/employee?schedule=\").concat(currentScheduleId),readOnly:true,className:\"employee-link-input\",onClick:e=>e.target.select()}),/*#__PURE__*/_jsx(\"button\",{className:\"copy-link-btn\",onClick:()=>{navigator.clipboard.writeText(\"\".concat(window.location.origin,\"/employee?schedule=\").concat(currentScheduleId));alert('Link copied to clipboard!');},children:\"\\uD83D\\uDCCB Copy\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"timeblock-creator\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Add Timeblock\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"creator-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Day:\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedDay,onChange:e=>setSelectedDay(e.target.value),children:daysOfWeek.map(day=>/*#__PURE__*/_jsx(\"option\",{value:day,children:day},day))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Start Time:\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedTime,onChange:e=>setSelectedTime(e.target.value),children:timeSlots.map(time=>/*#__PURE__*/_jsx(\"option\",{value:time,children:time},time))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Duration:\"}),/*#__PURE__*/_jsxs(\"select\",{value:duration,onChange:e=>setDuration(parseFloat(e.target.value)),children:[/*#__PURE__*/_jsx(\"option\",{value:0.5,children:\"30 minutes\"}),/*#__PURE__*/_jsx(\"option\",{value:1,children:\"1 hour\"}),/*#__PURE__*/_jsx(\"option\",{value:1.5,children:\"1.5 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:2,children:\"2 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:2.5,children:\"2.5 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:3,children:\"3 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:3.5,children:\"3.5 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:4,children:\"4 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:4.5,children:\"4.5 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:5,children:\"5 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:5.5,children:\"5.5 hours\"}),/*#__PURE__*/_jsx(\"option\",{value:6,children:\"6 hours\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Shift Type:\"}),/*#__PURE__*/_jsxs(\"select\",{value:shiftType,onChange:e=>setShiftType(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"both\",children:\"Both Grad & Undergrad\"}),/*#__PURE__*/_jsx(\"option\",{value:\"grad\",children:\"Graduate Students Only\"}),/*#__PURE__*/_jsx(\"option\",{value:\"undergrad\",children:\"Undergraduate Students Only\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"People Needed:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",max:\"10\",value:peopleNeeded,onChange:e=>setPeopleNeeded(parseInt(e.target.value))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"add-btn\",onClick:addTimeblock,children:\"Add Timeblock\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"schedule-preview\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Schedule Preview\"}),/*#__PURE__*/_jsx(\"div\",{className:\"weekly-calendar\",children:daysOfWeek.map(day=>/*#__PURE__*/_jsxs(\"div\",{className:\"day-column\",children:[/*#__PURE__*/_jsx(\"h4\",{children:day}),/*#__PURE__*/_jsx(\"div\",{className:\"day-timeblocks\",children:timeblocks.filter(block=>block.day===day).map(block=>/*#__PURE__*/_jsxs(\"div\",{className:\"timeblock \".concat(block.shiftType),onClick:()=>removeTimeblock(block.id),children:[/*#__PURE__*/_jsx(\"div\",{className:\"timeblock-time\",children:block.time}),/*#__PURE__*/_jsx(\"div\",{className:\"timeblock-info\",children:block.title})]},block.id))})]},day))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"save-template-btn\",onClick:saveScheduleTemplate,disabled:timeblocks.length===0,children:\"Save Schedule Template & Generate Employee Link\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"timeblock-count\",children:[\"Total Timeblocks: \",timeblocks.length]})]})]})]});const renderResponsesView=()=>/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Employee Responses\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Review employee preferences and set shift assignments\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"responses-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"response-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Response Summary\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total Responses: \",employeeResponses.length]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>loadEmployeeResponses(),className:\"refresh-btn\",children:\"Refresh Responses\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"employee-list\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Employee Shift Assignments\"}),employeeResponses.map(response=>/*#__PURE__*/_jsxs(\"div\",{className:\"employee-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"employee-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"name\",children:response.employeeName}),/*#__PURE__*/_jsx(\"span\",{className:\"type\",children:response.studentType}),/*#__PURE__*/_jsxs(\"span\",{className:\"submitted\",children:[\"Submitted: \",new Date(response.submittedAt).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"shift-assignment\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Shifts per week:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",max:\"10\",value:shiftsPerEmployee[response.employeeName]||0,onChange:e=>setShiftsPerEmployee(prev=>_objectSpread(_objectSpread({},prev),{},{[response.employeeName]:parseInt(e.target.value)}))})]})]},response.id))]}),/*#__PURE__*/_jsx(\"div\",{className:\"generate-section\",children:/*#__PURE__*/_jsx(\"button\",{className:\"generate-final-btn\",onClick:generateFinalSchedule,disabled:employeeResponses.length===0,children:\"Generate Final Schedule\"})})]})]});const renderGenerateView=()=>/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Final Schedule\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Generated schedule with assignments\"})]}),finalSchedule&&/*#__PURE__*/_jsxs(\"div\",{className:\"final-schedule\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"schedule-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Schedule Summary\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total Timeblocks: \",finalSchedule.summary.totalTimeblocks]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Assigned: \",finalSchedule.summary.assignedTimeblocks]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Fill Rate: \",finalSchedule.summary.overallFulfillmentRate]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"weekly-schedule-grid\",children:daysOfWeek.map(day=>/*#__PURE__*/_jsxs(\"div\",{className:\"day-column\",children:[/*#__PURE__*/_jsx(\"h4\",{children:day}),/*#__PURE__*/_jsx(\"div\",{className:\"day-assignments\",children:finalSchedule.schedule.timeblocks.filter(block=>block.day===day).map(block=>{const scheduleBlock=finalSchedule.schedule.schedule[block.id];const assignedEmployees=scheduleBlock.assignedEmployees||[];const remainingSlots=scheduleBlock.remainingSlots||0;return/*#__PURE__*/_jsxs(\"div\",{className:\"assignment-block\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"time\",children:block.time}),/*#__PURE__*/_jsx(\"div\",{className:\"assignment\",children:assignedEmployees.length>0?/*#__PURE__*/_jsxs(\"div\",{children:[assignedEmployees.map((employee,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"assigned-employee\",children:employee},index)),remainingSlots>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"unassigned-slots\",children:[\"+\",remainingSlots,\" more needed\"]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"unassigned\",children:[\"Unassigned (\",block.peopleNeeded||1,\" needed)\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"shift-type\",children:block.title})]},block.id);})})]},day))}),/*#__PURE__*/_jsxs(\"div\",{className:\"employee-assignments\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Employee Assignment Summary\"}),Object.entries(finalSchedule.summary.employeeSummary).map(_ref=>{let[employee,summary]=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"employee-summary\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"emp-name\",children:employee}),/*#__PURE__*/_jsxs(\"span\",{className:\"emp-stats\",children:[summary.assigned,\"/\",summary.requested,\" shifts (\",summary.fulfillmentRate,\")\"]})]},employee);})]})]})]});if(!isAuthenticated){return/*#__PURE__*/_jsx(AdminLogin,{onLogin:handleLogin});}return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin-nav\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"nav-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"nav-btn \".concat(currentView==='create'?'active':''),onClick:()=>setCurrentView('create'),children:\"Create Schedule\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"nav-btn \".concat(currentView==='responses'?'active':''),onClick:()=>setCurrentView('responses'),disabled:!currentScheduleId,children:[\"View Responses (\",employeeResponses.length,\")\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"nav-btn \".concat(currentView==='generate'?'active':''),onClick:()=>setCurrentView('generate'),disabled:!finalSchedule,children:\"Final Schedule\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"logout-btn\",onClick:handleLogout,children:\"Logout\"})]}),currentView==='create'&&renderCreateView(),currentView==='responses'&&renderResponsesView(),currentView==='generate'&&renderGenerateView()]});}export default AdminPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}